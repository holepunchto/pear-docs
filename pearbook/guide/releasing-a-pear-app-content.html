<div class="heading-link"><a href="#releasing-a-pear-application"><h1>#</h1></a><h1 id="releasing-a-pear-application">Releasing a Pear Application</h1></div>
<p>Pear applications are stored in an append-only log (<a href="https://github.com/holepunchto/hypercore">hypercore</a>).</p>
<p>Each version is identified by <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>&#x3C;fork>.&#x3C;length>.&#x3C;key></span></span></code></span>. The length corresponds to the length of the application's append-only log at the time.</p>
<p><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;">
      <iframe style="top: 0; left: 0; width: 100%; height: 100%; position: absolute; border: 0;" title="Youtube video player" src="https://www.youtube-nocookie.com/embed/OTwY_avUPyI?rel=0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share;" referrerpolicy="strict-origin-when-cross-origin"></iframe>
    </div>
        </p>
<p><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear run &#x3C;link></span></span></code></span> opens the application.</p>
<p>Before a release has been marked, the latest version is used. This is useful during development, to test the app locally and to share a preview with other peers.</p>
<p>Once a release has been marked, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear run &#x3C;link></span></span></code></span> opens the latest marked release.</p>
<div class="heading-link"><a href="#step-1-staging-production"><h2>#</h2></a><h2 id="step-1-staging-production">Step 1: Staging Production</h2></div>
<p><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear stage &#x3C;channel name></span></span></code></span> derives an application key from the channel name and the application name (as defined in the project's <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>package.json</span></span></code></span>).</p>
<p>For example, a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear stage dev</span></span></code></span> release channel used during development can be complemented with a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>production</span></span></code></span> channel:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="sh" data-theme="github-dark github-light"><code data-language="sh" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">pear</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> stage</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> production</span></span></code></pre></figure>
<p>Running this command in a Pear project folder outputs an application link.</p>
<p>Using separate channels for development and production means there is an application link for trusted peers and one for public peers.</p>
<p>The development link can remain unreleased, so that <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear run &#x3C;dev link></span></span></code></span> loads the latest staged changes by default.</p>
<p>The production link's releases can be marked, so that <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear run &#x3C;production link></span></span></code></span> loads the latest stable release by default.</p>
<div class="heading-link"><a href="#step-2-marking-a-release"><h2>#</h2></a><h2 id="step-2-marking-a-release">Step 2: Marking a Release</h2></div>
<p>Create a new release point with the latest staged changes on the production channel by running.</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>pear release production</span></span></code></pre></figure>
<p>Run <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear help release</span></span></code></span> for more info on the command.</p>
<p>Keep in mind that changes to an application can only propagate to peers when the application is being seeded:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>pear seed production</span></span></code></pre></figure>
<div class="heading-link"><a href="#step-3-running-staged-from-a-released-app"><h2>#</h2></a><h2 id="step-3-running-staged-from-a-released-app">Step 3: Running staged from a released app</h2></div>
<p>After marking a release, make a trivial change to the project (e.g. add a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>console.log(...)</span></span></code></span> somewhere).</p>
<p>First verify that it works by running <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear run --dev .</span></span></code></span></p>
<p>Now stage the change with <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear stage production</span></span></code></span>.</p>
<p>Opening the application with <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear run &#x3C;link></span></span></code></span> will <strong>not</strong> output the log, because it loads the latest <strong>marked</strong> release.</p>
<p>The latest staged changes of a released application can be previewed with the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>--checkout</span></span></code></span> flag:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>pear run --checkout=staged &#x3C;link></span></span></code></pre></figure>
<p>The value of the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>--checkout</span></span></code></span> flag may be <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>staged</span></span></code></span>, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>released</span></span></code></span> (the default) or a number referring to a specific version length.</p>
<div class="heading-link"><a href="#discussion"><h2>#</h2></a><h2 id="discussion">Discussion</h2></div>
<div class="heading-link"><a href="#the-dump-stage-release-strategy"><h3>#</h3></a><h3 id="the-dump-stage-release-strategy">The dump-stage-release strategy</h3></div>
<p>A development application link can be shared among trusted peers. At that point, it could be referred to as an internal application link (internal to the group of peers who have the link).</p>
<p>While using different channel names is sensible, using <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear stage dev</span></span></code></span> and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear stage production</span></span></code></span> on the same machine has practical implications.</p>
<p>A dump-stage-release strategy separates the concerns between development and production, by using a different machine for each.</p>
<p>On the machine that holds the production link, run:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>pear dump &#x3C;internal-link> &#x3C;path-to-app-production-dir></span></span></code></pre></figure>
<p>This is a reverse stage: it synchronizes the application files to disk.</p>
<p>Once complete, the project can be staged from the production machine with:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>pear stage production</span></span></code></pre></figure>
<p>Then released with:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>pear release production</span></span></code></pre></figure>
<p>To allow other peers access to the new release, run <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear seed production</span></span></code></span>.</p>
<div class="heading-link"><a href="#distribution-packages"><h3>#</h3></a><h3 id="distribution-packages">Distribution Packages</h3></div>
<p>Asset building of distribution packages (.dmg, .msi, .appimage) is not yet possible with Pear, but will be supported in the future.</p>
<div class="heading-link"><a href="#next"><h2>#</h2></a><h2 id="next">Next</h2></div>
<ul>
<li><a href="starting-a-pear-desktop-project.html">Starting a Pear Desktop Project</a></li>
<li><a href="making-a-pear-desktop-app.html">Making a Pear Desktop Application</a></li>
<li><a href="starting-a-pear-terminal-project.html">Starting a Pear Terminal Project</a></li>
<li><a href="making-a-pear-terminal-app.html">Making a Pear Terminal Application</a></li>
<li><a href="sharing-a-pear-app.html">Sharing a Pear Application</a></li>
</ul>