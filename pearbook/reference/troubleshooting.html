<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Pear Docs</title>
<meta content="width=device-width, initial-scale=1" name="viewport">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x9x.svg">
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="shortcut icon" href="/assets/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
<link rel="manifest" href="/assets/site.webmanifest">
<link href="/assets/index.css" rel="stylesheet">
</head>
<body>
<header class="site-header"><label class="site-header__button" id="table-of-contents-toggle-button" for="table-of-contents-toggle" type="button" aria-label="Open table of contents" aria-pressed="false" data-active="false" data-state="closed"><svg class="site-header__button-icon" style="mask-image:url(/assets/bars.svg);-webkit-mask-image:url(/assets/bars.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat;mask-position:center;-webkit-mask-position:center;background-color:currentColor"></svg></label><a href="/"><img alt="logo" src="/assets/pear-vector.svg"></a><div class="site-header__right"><div class="color-scheme-toggle"><button class="color-scheme-toggle__button"><div class="color-scheme-toggle__circle"></div></button></div></div></header><div class="site-container"><input id="table-of-contents-toggle" name="table-of-contents-toggle" type="checkbox"><aside class="table-of-contents" id="table-of-contents"><ul>
<li><a href="/index.html">Pear by Holepunch</a></li>
</ul>
<h3>Reference</h3>
<ul>
<li><a href="/reference/cli.html">Pear CLI</a></li>
<li><a href="/reference/configuration.html">Pear Application Configuration</a></li>
<li><a href="/reference/bare-overview.html">Bare Overview</a></li>
<li><a href="/reference/api.html">API</a></li>
<li><a href="/reference/templates.html">Templates</a></li>
<li><a href="/reference/node-compat.html">Node.js Compatibility</a></li>
<li><a href="/reference/recommended-practices.html">Recommended Practices</a></li>
<li><a href="/reference/troubleshooting.html">Troubleshooting</a></li>
<li><a href="/reference/faq.html">Frequently Asked Questions</a></li>
<li><a href="/reference/migration.html">Migration</a></li>
</ul>
<h3>Guides</h3>
<ul>
<li><a href="/guide/getting-started.html">Getting Started</a></li>
<li><a href="/guide/starting-a-pear-desktop-project.html">Starting a Pear Desktop Project</a></li>
<li><a href="/guide/making-a-pear-desktop-app.html">Making a Pear Desktop Application</a></li>
<li><a href="/guide/starting-a-pear-terminal-project.html">Starting a Pear Terminal Project</a></li>
<li><a href="/guide/making-a-pear-terminal-app.html">Making a Pear Terminal Application</a></li>
<li><a href="/guide/sharing-a-pear-app.html">Sharing a Pear Application</a></li>
<li><a href="/guide/releasing-a-pear-app.html">Releasing a Pear Application</a></li>
<li><a href="/guide/making-a-bare-mobile-app.html">Making a Bare Mobile Application</a></li>
<li><a href="/guide/debugging-a-pear-terminal-app.html">Debugging a Pear Terminal Application</a></li>
<li><a href="/guide/creating-a-pear-init-template.html">Creating a <code>pear init</code> Template</a></li>
</ul>
<h3>How-tos</h3>
<ul>
<li><a href="/howto/connect-two-peers-by-key-with-hyperdht.html">Connect two peers</a></li>
<li><a href="/howto/connect-to-many-peers-by-topic-with-hyperswarm.html">Connect many peers</a></li>
<li><a href="/howto/replicate-and-persist-with-hypercore.html">Replicate &#x26; persist</a></li>
<li><a href="/howto/work-with-many-hypercores-using-corestore.html">Manage multiple Hypercores</a></li>
<li><a href="/howto/share-append-only-databases-with-hyperbee.html">Share append-only databases</a></li>
<li><a href="/howto/create-a-full-peer-to-peer-filesystem-with-hyperdrive.html">Create a p2p filesystem</a></li>
</ul>
<h3>Pear Modules</h3>
<ul>
<li><a href="/index.html#application-libraries">Application Libraries</a></li>
<li><a href="/index.html#user-interface-libraries">User Interface Libraries</a></li>
<li><a href="/index.html#common-libraries">Common Libraries</a></li>
<li><a href="/index.html#developer-libraries">Developer Libraries</a></li>
<li><a href="/index.html#integration-libraries">Integration Libraries</a></li>
</ul>
<h3>P2P Modules</h3>
<ul>
<li><a href="/index.html#building-blocks">Building-Block Libraries</a></li>
<li><a href="/index.html#helpers">Helper Libraries</a></li>
</ul>
<h3>Building blocks</h3>
<ul>
<li><a href="/building-blocks/hypercore.html">Hypercore</a></li>
<li><a href="/building-blocks/hyperbee.html">Hyperbee</a></li>
<li><a href="/building-blocks/hyperdrive.html">Hyperdrive</a></li>
<li><a href="/building-blocks/autobase.html">Autobase</a></li>
<li><a href="/building-blocks/hyperdht.html">HyperDHT</a></li>
<li><a href="/building-blocks/hyperswarm.html">Hyperswarm</a></li>
</ul>
<h3>Helpers</h3>
<ul>
<li><a href="/helpers/corestore.html">Corestore</a></li>
<li><a href="/helpers/localdrive.html">Localdrive</a></li>
<li><a href="/helpers/mirrordrive.html">Mirrordrive</a></li>
<li><a href="/helpers/secretstream.html">Secretstream</a></li>
<li><a href="/helpers/compact-encoding.html">Compact encoding</a></li>
<li><a href="/helpers/protomux.html">Protomux</a></li>
</ul>
<h3>Bare Modules</h3>
<ul>
<li><a href="/index.html#bare-modules">Standard Libraries</a></li>
</ul>
<h3>Tools</h3>
<ul>
<li><a href="/index.html#tools">Tool List</a></li>
<li><a href="/tools/hypershell.html">Hypershell</a></li>
<li><a href="/tools/hypertele.html">Hypertele</a></li>
<li><a href="/tools/hyperbeam.html">Hyperbeam</a></li>
<li><a href="/tools/hyperssh.html">Hyperssh</a></li>
<li><a href="/tools/drives.html">Drives</a></li>
</ul>
<h3>Examples</h3>
<ul>
<li><a href="https://github.com/holepunchto/pear/tree/main/examples/terminal">Pear Terminal</a></li>
<li><a href="https://github.com/holepunchto/pear/tree/main/examples/desktop">Pear Desktop (Electron)</a></li>
<li><a href="https://github.com/holepunchto/bare-android">Bare Android</a></li>
<li><a href="https://github.com/holepunchto/bare-ios">Bare iOS</a></li>
</ul></aside><main class="site-content"><div class="heading-link"><a href="#troubleshooting"><h1>#</h1></a><h1 id="troubleshooting">Troubleshooting</h1></div>
<ul>
<li><a href="#pear">Pear</a></li>
<li><a href="#bare">Bare</a></li>
</ul>
<div class="heading-link"><a href="#pear"><h2>#</h2></a><h2 id="pear">Pear<a name="pear"></a></h2></div>
<p>Troubleshooting confusing scenarios while developing Pear applications.</p>
<div class="heading-link"><a href="#pear.teardown-callback-fires-but-worker-keeps-running"><h3>#</h3></a><h3 id="pear.teardown-callback-fires-but-worker-keeps-running"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Pear.teardown</span></span></code></span> Callback Fires But Worker Keeps Running</h3></div>
<p>The <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Pear.teardown(cb)</span></span></code></span> callback is triggered whenever the Pear app start to unload. If it is not exiting, then something is keeping the applications event loop running. A common cause of this is not cleaning up the <a href="api.html#pear-worker">worker pipe</a> by calling <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pipe.end()</span></span></code></span> to gracefully end the writable part of the stream.</p>
<div class="heading-link"><a href="#pear-cli-exits-without-running-the-application"><h3>#</h3></a><h3 id="pear-cli-exits-without-running-the-application"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear</span></span></code></span> CLI Exits Without Running the Application</h3></div>
<p>If after debugging an application it seems the issue is happening in the Pear platform itself, try the following steps to debug the issue:</p>
<ol>
<li>Run pear command with logs enabled <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear --log [command]</span></span></code></span>.</li>
<li>If no helpful info, run sidecar with logs <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear sidecar --log-level 3</span></span></code></span>.
If the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>pear sidecar</span></span></code></span> stops after printing <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Closing any current Sidecar clients...</span></span></code></span>, then the current Pear Sidecar process is hanging. Check the next steps for forensics that might explain why, but then kill existing Pear processes.
<em>Note</em> that this will close any running pear applications such as Keet.</li>
<li>If still no helpful info, check that there are still pear processes running via <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>ps aux | grep pear</span></span></code></span> or equivalent method for finding processes by name.</li>
<li>Finally check the crash logs in platform's <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>current</span></span></code></span> directory.
<ul>
<li>For sidecar: <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>sidecar.crash.log</span></span></code></span></li>
<li>For electron: <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>electron-main.crash.log</span></span></code></span></li>
<li>For pear cli: <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>cli.crash.log</span></span></code></span></li>
</ul>
</li>
</ol>
<div class="heading-link"><a href="#you-get-a-error-while-lock-file-..-resource-temporarily-unavailable"><h3>#</h3></a><h3 id="you-get-a-error-while-lock-file-..-resource-temporarily-unavailable">You get a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Error: While lock File .. Resource temporarily unavailable</span></span></code></span></h3></div>
<p>The Error:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>Uncaught (in promise) Error: While lock file: ./pear/app-storage/by-random/.../db/LOCK: Resource temporarily unavailable</span></span>
<span data-line=""><span>    at Object.onopen (pear://dev/node_modules/rocksdb-native/lib/state.js:155:27)</span></span></code></pre></figure>
<p>Means the application is trying to open a RockDB instance on files currently
locked by another process. This means either:</p>
<ul>
<li>An application is trying to open the same storage twice.
If using <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Corestore</span></span></code></span>, it is recommended to only create only one instance and
reusing it.</li>
<li>There are multiple of processes running for the same application.</li>
</ul>
<div class="heading-link"><a href="#joining-a-hyperswarm-topic-takes-a-long-time"><h3>#</h3></a><h3 id="joining-a-hyperswarm-topic-takes-a-long-time">Joining a Hyperswarm Topic takes a long time</h3></div>
<p>There can be many reasons but here are a few common reasons:</p>
<ul>
<li>
<p>Random NAT networks can take longer as another node may be needed to facility the connection.</p>
</li>
<li>
<p>Not destroying the hyperswarm instance in the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Pear.teardown()</span></span></code></span> callback so
Hyperswarm can unannounce and clean up the DHT.
It's recommended to clean up the hyperswarm instance with <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>swarm.destroy()</span></span></code></span> before exiting the application. This prevents conflicting records in the DHT for the application's peer which cause it take longer to join a topic.</p>
<p>Example:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="js" data-theme="github-dark github-light"><code data-language="js" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">Pear.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">teardown</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(() </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=></span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> swarm.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">destroy</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">())</span></span></code></pre></figure>
<p>Make sure to unregister the teardown callback if the swarm is destroyed
prematurely.</p>
</li>
<li>
<p>A firewall is blocking the traffic.
Please let Holepunch know if this is the case.</p>
</li>
</ul>
<div class="heading-link"><a href="#running-bare-modules-in-pear-desktop-applications"><h3>#</h3></a><h3 id="running-bare-modules-in-pear-desktop-applications">Running Bare modules in Pear Desktop Applications</h3></div>
<p>For now this is not possible because Pear desktop applications run in Electron which uses Node.js integration. Pear v2 will unify running Pear applications in Bare with Electron as a UI module. This way the main application will be defined as a "Pear-end" process that can be shared across different versions of the application such as CLI, GUI, mobile, etc.</p>
<p>Running a Bare module will give you one of the following errors:</p>
<ul>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Uncaught TypeError: require.addon is not a function</span></span></code></span></li>
<li><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Uncaught ReferenceError: Bare is not defined</span></span></code></span></li>
</ul>
<p>To support both Bare and Node.js compatible modules, import maps can be defined
so a module <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>fs</span></span></code></span> can be resolved to <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-fs</span></span></code></span> on Bare and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>fs</span></span></code></span> on Node.js.</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>{</span></span>
<span data-line=""><span>  "imports": {</span></span>
<span data-line=""><span>    "fs": {</span></span>
<span data-line=""><span>      "bare": "bare-fs",</span></span>
<span data-line=""><span>      "default": "fs"</span></span>
<span data-line=""><span>    },</span></span>
<span data-line=""><span>    "fs/*": {</span></span>
<span data-line=""><span>      "bare": "bare-fs/*",</span></span>
<span data-line=""><span>      "default": "fs/*"</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>  },</span></span>
<span data-line=""><span>  "dependencies": {</span></span>
<span data-line=""><span>    "bare-fs": "^2.1.5"</span></span>
<span data-line=""><span>  }</span></span>
<span data-line=""><span>}</span></span></code></pre></figure>
<p>See <a href="https://github.com/holepunchto/bare-node#import-maps"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-node</span></span></code></span>'s "Import maps"</a> for more details.</p>
<div class="heading-link"><a href="#bare"><h2>#</h2></a><h2 id="bare">Bare<a name="bare"></a></h2></div>
<p>Troubleshooting confusing scenarios while developing Pear applications.</p>
<div class="heading-link"><a href="#missing-builtin-modules-when-running-with-bare"><h3>#</h3></a><h3 id="missing-builtin-modules-when-running-with-bare">Missing builtin Modules when Running with Bare</h3></div>
<p>Bare is minimal by design, so does not include all of the modules provided with Node.js. Instead modules such as <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>process</span></span></code></span> can be imported as a Bare specific module, for example <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-process</span></span></code></span>. For a list of Node.js builtins and their Bare replacements, check out <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-node</span></span></code></span>'s <a href="https://github.com/holepunchto/bare-node#modules">"Modules" table</a></p>
<div class="heading-link"><a href="#writing-a-module-with-support-for-bare--node.js"><h4>#</h4></a><h4 id="writing-a-module-with-support-for-bare--node.js">Writing a module with Support for Bare &#x26; Node.js</h4></div>
<p>If writing a library that can be run in both the Bare and Node.js runtimes, import maps should be used to support both the Bare version and the Node.js version of builtin modules. Import maps only apply to the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>package.json</span></span></code></span>'s package so does not modify dependencies of the module.</p>
<p>See <a href="https://github.com/holepunchto/bare-node#import-maps"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-node</span></span></code></span>'s "Import maps"</a> for more details.</p>
<div class="heading-link"><a href="#running-3rd-party-modules-written-for-node.js"><h4>#</h4></a><h4 id="running-3rd-party-modules-written-for-node.js">Running 3rd Party Modules Written for Node.js</h4></div>
<p>To support dependencies that rely on Node.js builtins (eg. <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>fs</span></span></code></span>, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>os</span></span></code></span>, etc), an alias can be used to point to a wrapper module to use the Bare version. For example to use <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-net</span></span></code></span> where ever <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>net</span></span></code></span> is used in dependencies, install it as an alias:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>npm i bare-net net@npm:bare-node-net</span></span></code></pre></figure>
<p>See <a href="./node-compat">Node.js Compatibility</a> for more info.</p>
<p>For compatibility and to support builtin globals, such as <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>process</span></span></code></span>, the corresponding <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-*</span></span></code></span> module will include a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>/global.js</span></span></code></span> submodule that sets the global variable to <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>global</span></span></code></span>. This is useful when importing modules that assume the global variable exists. It is not recommended to use global variables when writing new code as it is less flexible and a harder to upgrade piecemeal.</p>
<p>Usage of a globals submodule looks like:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>require('bare-process/global')</span></span>
<span data-line=""><span>console.log('platform', process.platform) // now prints</span></span></code></pre></figure>
<div class="heading-link"><a href="#addonerror-addon_not_found-cannot-find-addon-when-running-bare"><h3>#</h3></a><h3 id="addonerror-addon_not_found-cannot-find-addon-when-running-bare"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>AddonError: ADDON_NOT_FOUND: Cannot find addon</span></span></code></span> when running Bare</h3></div>
<p>As the error suggests, this is because the native addon cannot be found. This could either be because the addon is missing or Bare is looking in a different place than expected.</p>
<p>A few reasons why an addon may be missing:</p>
<ul>
<li>
<p>The addon is not available for the current platform and/or architecture.
To see what platform and architecture Bare is running on, log <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Bare.platform</span></span></code></span> and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Bare.arch</span></span></code></span>.</p>
</li>
<li>
<p>The addon wasn't linked ahead of time.
Mobile applications require native code to be linked as part of compiling the application.</p>
<p>If developing with <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>react-native-bare-kit</span></span></code></span> (including using <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-expo</span></span></code></span> as a template), check that the addon was loaded in <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>node_modules/react-native-bare-kit/ios/addons</span></span></code></span> for iOS and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>node_modules/react-native-bare-kit/android/src/main/addons</span></span></code></span> for Android. This is where the libraries are linked from.</p>
<p>If other solutions are not working, it may be an issue with the build cache. Try clearing the cache and recompiling.</p>
</li>
</ul>
<div class="heading-link"><a href="#bare-pack-with-conditional-module-loading"><h3>#</h3></a><h3 id="bare-pack-with-conditional-module-loading"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-pack</span></span></code></span> with conditional module loading</h3></div>
<p><a href="https://github.com/holepunchto/bare-pack"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-pack</span></span></code></span></a> does not evaluate your code but scans for imports. This means it cannot infer dynamic imports but assumes all imports will be loaded for the target platform. For example:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>const { runtime } = require('which-runtime')</span></span>
<span data-line=""> </span>
<span data-line=""><span>let crypto</span></span>
<span data-line=""><span>if (runtime === 'bare') {</span></span>
<span data-line=""><span>  crypto = require('bare-crypto')</span></span>
<span data-line=""><span>} else {</span></span>
<span data-line=""><span>  crypto = require('node:crypto')</span></span>
<span data-line=""><span>}</span></span></code></pre></figure>
<p>Will thrown:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span>./node_modules/paparam/index.js:514</span></span>
<span data-line=""><span>    throw new Bail(bail.reason)</span></span>
<span data-line=""><span>          ^</span></span>
<span data-line=""> </span>
<span data-line=""><span>Bail: ModuleTraverseError: MODULE_NOT_FOUND: Cannot find module 'node:crypto' imported from 'file://./index.js'</span></span>
<span data-line=""><span>    at exports.imports (./node_modules/bare-module-traverse/index.js:331:24)</span></span>
<span data-line=""><span>    at exports.imports.next (&#x3C;anonymous>)</span></span>
<span data-line=""><span>    at exports.module (./node_modules/bare-module-traverse/index.js:152:18)</span></span>
<span data-line=""><span>    at exports.module.next (&#x3C;anonymous>)</span></span>
<span data-line=""><span>    at process (./node_modules/bare-pack/index.js:50:26)</span></span>
<span data-line=""><span>    at async pack (./node_modules/bare-pack/index.js:24:3)</span></span>
<span data-line=""><span>    at async Command._runner (./node_modules/bare-pack/bin.js:46:18)</span></span>
<span data-line=""><span>    at async runAsync (./node_modules/paparam/index.js:793:5)</span></span>
<span data-line=""><span>    at Command._bail (./node_modules/paparam/index.js:514:11)</span></span>
<span data-line=""><span>    at Command.bail (./node_modules/paparam/index.js:127:36)</span></span>
<span data-line=""><span>    at runAsync (./node_modules/paparam/index.js:795:7)</span></span></code></pre></figure>
<p>This is because it is trying to pack <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>node:crypto</span></span></code></span> for Bare which isn't possible.</p>
<p>Instead of dynamic conditions based on runtime environment, modules should have an import map defined to use the correct module for the given runtime.</p>
<p>See <a href="https://github.com/holepunchto/bare-node#import-maps"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bare-node</span></span></code></span>'s "Import maps"</a> for more details.</p></main></div><script type="module" src="/assets/index.js"></script>
</body>
</html>
